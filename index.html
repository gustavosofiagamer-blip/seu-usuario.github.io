<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pega-Pega das Bolas</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#111;
}
canvas{display:block}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

// ================= CONFIG =================
const RAIO = 14;
const FPS = 60;
const TEMPO_MAX = 10 * FPS;

const CORES = [
  {nome:"Amarelo", cor:"yellow"},
  {nome:"Vermelho", cor:"red"},
  {nome:"Azul", cor:"dodgerblue"},
  {nome:"Verde", cor:"lime"}
];

// ================= ESTADO =================
let estado = "roleta";
let tempo = 0;

let roletas = [];
let resultado = [];

let pegadora, fugitiva;
let confetes = [];

let framesRoleta = 120;        // tempo girando
let esperaResultado = 0;       // tempo parado mostrando resultado

// ================= ROLETAS =================
function criarRoleta(x,y){
  return {
    x,y,
    angulo:Math.random()*Math.PI*2,
    vel:0.45
  };
}

function desenharRoleta(r){
  const raio=120;
  const fatia=(Math.PI*2)/CORES.length;

  for(let i=0;i<CORES.length;i++){
    ctx.beginPath();
    ctx.moveTo(r.x,r.y);
    ctx.fillStyle=CORES[i].cor;
    ctx.arc(
      r.x,r.y,
      raio,
      r.angulo+i*fatia,
      r.angulo+(i+1)*fatia
    );
    ctx.fill();
  }

  // seta
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.moveTo(r.x,r.y-raio-18);
  ctx.lineTo(r.x-12,r.y-raio);
  ctx.lineTo(r.x+12,r.y-raio);
  ctx.fill();
}

function sortearCores(){
  let i = Math.floor(Math.random()*CORES.length);
  let j;
  do{
    j = Math.floor(Math.random()*CORES.length);
  }while(j===i);
  return [CORES[i], CORES[j]];
}

// ================= JOGO =================
function criarBola(cor){
  return{
    cor,
    x:Math.random()*(canvas.width-RAIO*2)+RAIO,
    y:Math.random()*(canvas.height-RAIO*2)+RAIO,
    vx:0, vy:0
  };
}

function iniciarJogo(){
  pegadora = criarBola(resultado[0].cor);
  fugitiva = criarBola(resultado[1].cor);
  tempo = TEMPO_MAX;
  estado = "jogo";
}

function criarConfetes(cor){
  for(let i=0;i<150;i++){
    confetes.push({
      x:canvas.width/2,
      y:canvas.height/2,
      dx:(Math.random()-0.5)*10,
      dy:(Math.random()-0.5)*10,
      vida:90,
      cor
    });
  }
}

// ================= LOOP =================
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // -------- ROLETAS --------
  if(estado==="roleta"){
    if(roletas.length===0){
      roletas = [
        criarRoleta(canvas.width*0.35,canvas.height/2),
        criarRoleta(canvas.width*0.65,canvas.height/2)
      ];
      resultado = sortearCores();
      framesRoleta = 120;             // gira 2s
      esperaResultado = 0;
    }

    roletas.forEach(r=>{
      if(framesRoleta > 0){
        r.angulo += r.vel;
        r.vel *= 0.985;
      }
      desenharRoleta(r);
    });

    if(framesRoleta > 0){
      framesRoleta--;
      if(framesRoleta === 0){
        roletas.forEach(r=>r.vel=0);
        esperaResultado = 300;        // â­ 5 segundos (60fps)
      }
    } 
    else if(esperaResultado > 0){
      esperaResultado--;
      if(esperaResultado === 0){
        roletas = [];
        iniciarJogo();
      }
    }
  }

  // -------- JOGO --------
  if(estado==="jogo"){
    tempo--;

    // TIMER GIGANTE
    ctx.fillStyle="#444";
    ctx.font=`900 ${Math.min(canvas.width,canvas.height)*0.65}px Arial`;
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(
      Math.ceil(tempo/FPS),
      canvas.width/2,
      canvas.height/2
    );

    let ang = Math.atan2(
      fugitiva.y-pegadora.y,
      fugitiva.x-pegadora.x
    );

    pegadora.vx = Math.cos(ang)*3;
    pegadora.vy = Math.sin(ang)*3;

    fugitiva.vx = -Math.cos(ang)*2.2;
    fugitiva.vy = -Math.sin(ang)*2.2;

    [pegadora,fugitiva].forEach(b=>{
      b.x += b.vx;
      b.y += b.vy;

      b.x = Math.max(RAIO,Math.min(canvas.width-RAIO,b.x));
      b.y = Math.max(RAIO,Math.min(canvas.height-RAIO,b.y));

      ctx.beginPath();
      ctx.arc(b.x,b.y,RAIO,0,Math.PI*2);
      ctx.fillStyle=b.cor;
      ctx.fill();
    });

    if(Math.hypot(
      pegadora.x-fugitiva.x,
      pegadora.y-fugitiva.y
    ) < RAIO*2){
      criarConfetes(pegadora.cor);
      estado="fim";
    }

    if(tempo<=0){
      criarConfetes(fugitiva.cor);
      estado="fim";
    }
  }

  // -------- CONFETES --------
  confetes.forEach((c,i)=>{
    c.x+=c.dx;
    c.y+=c.dy;
    c.dy+=0.3;
    c.vida--;
    ctx.fillStyle=c.cor;
    ctx.fillRect(c.x,c.y,4,4);
    if(c.vida<=0) confetes.splice(i,1);
  });

  if(estado==="fim" && confetes.length===0){
    estado="roleta";
  }

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
